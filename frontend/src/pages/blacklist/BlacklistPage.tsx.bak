import React, { useState, useEffect, useRef } from 'react';import React, { useState, useEffect, useRef } from 'react';import React, { useState, useEffect, useRef } from 'react';

import { BlacklistEntry } from '../../types';

import * as api from '../../services/api';import { BlacklistEntry } from '../../types';import { BlacklistEntry } from '../../types';

import { Shield, Search, UserX, Mail, AlertCircle, Camera, Upload, Trash2, X } from 'lucide-react';

import * as api from '../../services/api';import * as api from '../../services/api';

export const BlacklistPage: React.FC = () => {

  const [blacklistEntries, setBlacklistEntries] = useState<BlacklistEntry[]>([]);import { Shield, Search, UserX, Mail, AlertCircle, Camera, Upload, Trash2, X } from 'lucide-react';import { Shield, Search, UserX, Mail, AlertCircle, Camera, Upload, Trash2, X } from 'lucide-react';

  const [loading, setLoading] = useState(true);

  const [showAddForm, setShowAddForm] = useState(false);

  const [searchTerm, setSearchTerm] = useState('');

  const fileInputRef = useRef<HTMLInputElement>(null);export const BlacklistPage: React.FC = () => {export const BlacklistPage: React.FC = () => {

  const [newEntry, setNewEntry] = useState({

    visitorName: '',  const [blacklistEntries, setBlacklistEntries] = useState<BlacklistEntry[]>([]);  const [blacklistEntries, setBlacklistEntries] = useState<BlacklistEntry[]>([]);

    email: '',

    reason: '',  const [loading, setLoading] = useState(true);  const [loading, setLoading] = useState(true);

    photo: ''

  });  const [showAddForm, setShowAddForm] = useState(false);  const [showAddForm, setShowAddForm] = useState(false);



  useEffect(() => {  const [searchTerm, setSearchTerm] = useState('');  const [searchTerm, setSearchTerm] = useState('');

    loadBlacklist();

  }, []);  const fileInputRef = useRef<HTMLInputElement>(null);  const fileInputRef = useRef<HTMLInputElement>(null);



  const loadBlacklist = async () => {  const [newEntry, setNewEntry] = useState({  const [newEntry, setNewEntry] = useState({

    try {

      setLoading(true);    visitorName: '',    visitorName: '',

      const entries = await api.getBlacklist();

      setBlacklistEntries(entries as BlacklistEntry[]);    email: '',    email: '',

    } catch (error) {

      console.error('Error loading blacklist:', error);    reason: '',    reason: '',

    } finally {

      setLoading(false);    photo: ''    photo: ''

    }

  };  });  });



  const handlePhotoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {

    const file = e.target.files?.[0];

    if (file) {  useEffect(() => {  useEffect(() => {

      // Validar tama√±o (5MB m√°ximo)

      if (file.size > 5 * 1024 * 1024) {    loadBlacklist();    loadBlacklist();

        alert('El archivo es demasiado grande. M√°ximo 5MB.');

        return;  }, []);  }, []);

      }



      // Validar tipo

      if (!file.type.match(/image\/(jpeg|jpg|png|gif|webp)/)) {  const loadBlacklist = async () => {  const loadBlacklist = async () => {

        alert('Solo se permiten archivos de imagen (jpeg, jpg, png, gif, webp)');

        return;    try {    try {

      }

      setLoading(true);      setLoading(true);

      const reader = new FileReader();

      reader.onload = (event) => {      const entries = await api.getBlacklist();      const entries = await api.getBlacklist();

        const base64Photo = event.target?.result as string;

        setNewEntry({ ...newEntry, photo: base64Photo });      setBlacklistEntries(entries as BlacklistEntry[]);      setBlacklistEntries(entries);

      };

      reader.readAsDataURL(file);    } catch (error) {    } catch (error) {

    }

  };      console.error('Error loading blacklist:', error);      console.error('Error loading blacklist:', error);



  const handleAdd = async (e: React.FormEvent) => {    } finally {    } finally {

    e.preventDefault();

          setLoading(false);      setLoading(false);

    if (!newEntry.visitorName || !newEntry.email || !newEntry.reason) {

      alert('El nombre, correo electr√≥nico y motivo son requeridos');    }    }

      return;

    }  };  };



    // Validar formato de email

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!emailRegex.test(newEntry.email)) {  const handlePhotoUpload = (e: React.ChangeEvent<HTMLInputElement>) => {  const handleAdd = async (e: React.FormEvent) => {

      alert('Por favor, ingrese un correo electr√≥nico v√°lido');

      return;    const file = e.target.files?.[0];    e.preventDefault();

    }

        if (file) {    

    try {

      console.log('üö´ Adding to blacklist:', newEntry);      // Validar tama√±o (5MB m√°ximo)    if (!newEntry.identifier || !newEntry.reason) {

      

      const entry = await api.addToBlacklist({      if (file.size > 5 * 1024 * 1024) {      alert('El identificador y la raz√≥n son requeridos');

        visitorName: newEntry.visitorName,

        email: newEntry.email,        alert('El archivo es demasiado grande. M√°ximo 5MB.');      return;

        reason: newEntry.reason,

        photo: newEntry.photo || undefined        return;    }

      });

      console.log('‚úÖ Blacklist entry added:', entry);      }    

      

      setBlacklistEntries([...blacklistEntries, entry as BlacklistEntry]);    try {

      setNewEntry({ 

        visitorName: '',      // Validar tipo      console.log('üö´ Adding to blacklist:', newEntry);

        email: '',

        reason: '',      if (!file.type.match(/image\/(jpeg|jpg|png|gif|webp)/)) {      

        photo: ''

      });        alert('Solo se permiten archivos de imagen (jpeg, jpg, png, gif, webp)');      // Convert form data to backend format

      setShowAddForm(false);

    } catch (error) {        return;      const blacklistData = {

      console.error('‚ùå Error adding to blacklist:', error);

      const errorMessage = error instanceof Error ? error.message : 'Error desconocido';      }        email: newEntry.identifierType === 'email' ? newEntry.identifier : '',

      alert(`Error al agregar a la lista negra: ${errorMessage}`);

    }        name: newEntry.identifierType === 'email' 

  };

      const reader = new FileReader();          ? `Usuario con email ${newEntry.identifier}` 

  const handleRemove = async (id: string) => {

    if (!confirm('¬øEst√° seguro de que desea eliminar esta entrada de la lista negra?')) {      reader.onload = (event) => {          : `${newEntry.identifier} (${newEntry.identifierType})`,

      return;

    }        const base64Photo = event.target?.result as string;        reason: newEntry.reason



    try {        setNewEntry({ ...newEntry, photo: base64Photo });      };

      await api.removeFromBlacklist(id);

      setBlacklistEntries(blacklistEntries.filter(entry => entry._id !== id));      };      

    } catch (error) {

      console.error('Error removing from blacklist:', error);      reader.readAsDataURL(file);      console.log('üì§ Sending blacklist data:', blacklistData);

      alert('Error al eliminar de la lista negra');

    }    }      

  };

  };      const entry = await api.addToBlacklist(blacklistData);

  const filteredEntries = blacklistEntries.filter(entry =>

    entry.visitorName.toLowerCase().includes(searchTerm.toLowerCase()) ||      console.log('‚úÖ Blacklist entry added:', entry);

    entry.identifier.toLowerCase().includes(searchTerm.toLowerCase()) ||

    entry.reason.toLowerCase().includes(searchTerm.toLowerCase())  const handleAdd = async (e: React.FormEvent) => {      

  );

    e.preventDefault();      setBlacklistEntries([...blacklistEntries, entry]);

  return (

    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50">          setNewEntry({ 

      <div className="max-w-7xl mx-auto p-6">

        {/* Header */}    if (!newEntry.visitorName || !newEntry.email || !newEntry.reason) {        identifierType: 'email' as 'document' | 'phone' | 'email',

        <div className="mb-8">

          <div className="flex items-center gap-3 mb-2">      alert('El nombre, correo electr√≥nico y motivo son requeridos');        identifier: '',

            <div className="p-3 bg-red-100 rounded-xl">

              <Shield className="w-8 h-8 text-red-600" />      return;        reason: '',

            </div>

            <div>    }        notes: ''

              <h1 className="text-3xl font-bold text-gray-900">Lista Negra</h1>

              <p className="text-gray-600 mt-1">      });

                Gestiona las personas restringidas de acceso a las instalaciones

              </p>    // Validar formato de email      setShowAddForm(false);

            </div>

          </div>    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;    } catch (error) {

        </div>

    if (!emailRegex.test(newEntry.email)) {      console.error('‚ùå Error adding to blacklist:', error);

        {/* Search and Add Button */}

        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">      alert('Por favor, ingrese un correo electr√≥nico v√°lido');      const errorMessage = error instanceof Error ? error.message : 'Error desconocido';

          <div className="flex flex-col sm:flex-row gap-4 items-center">

            <div className="flex-1 w-full relative">      return;      alert(`Error al agregar a la lista negra: ${errorMessage}`);

              <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />

              <input    }    }

                type="text"

                placeholder="Buscar por nombre, correo o motivo..."      };

                value={searchTerm}

                onChange={(e) => setSearchTerm(e.target.value)}    try {

                className="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"

              />      console.log('üö´ Adding to blacklist:', newEntry);  const handleRemove = async (id: string) => {

            </div>

            <button          if (!confirm('¬øEst√° seguro de que desea eliminar esta entrada de la lista negra?')) {

              onClick={() => setShowAddForm(true)}

              className="w-full sm:w-auto px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg shadow-red-200 font-semibold flex items-center justify-center gap-2"      const entry = await api.addToBlacklist({      return;

            >

              <UserX className="w-5 h-5" />        visitorName: newEntry.visitorName,    }

              Agregar a Lista Negra

            </button>        email: newEntry.email,

          </div>

        </div>        reason: newEntry.reason,    try {



        {/* Content */}        photo: newEntry.photo || undefined      await api.removeFromBlacklist(id);

        {loading ? (

          <div className="flex items-center justify-center py-20">      });      setBlacklistEntries(blacklistEntries.filter(entry => entry._id !== id));

            <div className="text-center">

              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"></div>      console.log('‚úÖ Blacklist entry added:', entry);    } catch (error) {

              <p className="text-gray-600">Cargando lista negra...</p>

            </div>            console.error('Error removing from blacklist:', error);

          </div>

        ) : filteredEntries.length === 0 ? (      setBlacklistEntries([...blacklistEntries, entry as BlacklistEntry]);      alert('Error al eliminar de la lista negra');

          <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">

            <div className="max-w-md mx-auto">      setNewEntry({     }

              <div className="p-4 bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">

                <UserX className="w-10 h-10 text-gray-400" />        visitorName: '',  };

              </div>

              <h3 className="text-xl font-semibold text-gray-900 mb-2">        email: '',

                {searchTerm ? 'No se encontraron resultados' : 'No hay entradas en la lista negra'}

              </h3>        reason: '',  const filteredEntries = blacklistEntries.filter(entry =>

              <p className="text-gray-600">

                {searchTerm         photo: ''    entry.identifier.toLowerCase().includes(searchTerm.toLowerCase()) ||

                  ? 'Intenta con otros t√©rminos de b√∫squeda' 

                  : 'Agrega personas a la lista negra para restringir su acceso'}      });    entry.reason.toLowerCase().includes(searchTerm.toLowerCase()) ||

              </p>

            </div>      setShowAddForm(false);    (entry.notes && entry.notes.toLowerCase().includes(searchTerm.toLowerCase()))

          </div>

        ) : (    } catch (error) {  );

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            {filteredEntries.map((entry) => (      console.error('‚ùå Error adding to blacklist:', error);

              <div

                key={entry._id}      const errorMessage = error instanceof Error ? error.message : 'Error desconocido';  const getIdentifierTypeLabel = (type: string) => {

                className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all duration-300 group"

              >      alert(`Error al agregar a la lista negra: ${errorMessage}`);    switch (type) {

                {/* Photo Section */}

                <div className="relative h-48 bg-gradient-to-br from-red-50 to-red-100">    }      case 'document': return 'Documento';

                  {entry.photo ? (

                    <img  };      case 'phone': return 'Tel√©fono';

                      src={entry.photo}

                      alt={entry.visitorName}      case 'email': return 'Email';

                      className="w-full h-full object-cover"

                    />  const handleRemove = async (id: string) => {      default: return type;

                  ) : (

                    <div className="w-full h-full flex items-center justify-center">    if (!confirm('¬øEst√° seguro de que desea eliminar esta entrada de la lista negra?')) {    }

                      <div className="p-6 bg-red-200 rounded-full">

                        <UserX className="w-16 h-16 text-red-600" />      return;  };

                      </div>

                    </div>    }

                  )}

                  <div className="absolute top-3 right-3">  return (

                    <button

                      onClick={() => handleRemove(entry._id)}    try {    <div className="max-w-6xl mx-auto p-6">

                      className="p-2 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-red-50 transition-colors shadow-lg"

                      title="Eliminar de la lista negra"      await api.removeFromBlacklist(id);      <div className="bg-white rounded-lg shadow-md">

                    >

                      <Trash2 className="w-5 h-5 text-red-600" />      setBlacklistEntries(blacklistEntries.filter(entry => entry._id !== id));        <div className="p-6 border-b border-gray-200">

                    </button>

                  </div>    } catch (error) {          <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">

                </div>

      console.error('Error removing from blacklist:', error);            <h2 className="text-2xl font-bold text-gray-800">Lista Negra</h2>

                {/* Content Section */}

                <div className="p-6">      alert('Error al eliminar de la lista negra');            <button

                  <h3 className="text-xl font-bold text-gray-900 mb-3 group-hover:text-red-600 transition-colors">

                    {entry.visitorName}    }              onClick={() => setShowAddForm(true)}

                  </h3>

                    };              className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors"

                  <div className="space-y-3">

                    <div className="flex items-start gap-2">            >

                      <Mail className="w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5" />

                      <div className="flex-1 min-w-0">  const filteredEntries = blacklistEntries.filter(entry =>              Agregar a Lista Negra

                        <p className="text-sm text-gray-500 mb-1">Correo electr√≥nico</p>

                        <p className="text-sm font-medium text-gray-900 break-all">{entry.identifier}</p>    entry.visitorName.toLowerCase().includes(searchTerm.toLowerCase()) ||            </button>

                      </div>

                    </div>    entry.identifier.toLowerCase().includes(searchTerm.toLowerCase()) ||          </div>



                    <div className="flex items-start gap-2">    entry.reason.toLowerCase().includes(searchTerm.toLowerCase())

                      <AlertCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />

                      <div className="flex-1">  );          <div className="mt-4">

                        <p className="text-sm text-gray-500 mb-1">Motivo</p>

                        <p className="text-sm text-gray-900 leading-relaxed">{entry.reason}</p>            <input

                      </div>

                    </div>  return (              type="text"



                    <div className="pt-3 border-t border-gray-100">    <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-50">              placeholder="Buscar por identificador, raz√≥n o notas..."

                      <p className="text-xs text-gray-500">

                        Agregado el {new Date(entry.createdAt).toLocaleDateString('es-MX', {      <div className="max-w-7xl mx-auto p-6">              value={searchTerm}

                          year: 'numeric',

                          month: 'long',        {/* Header */}              onChange={(e) => setSearchTerm(e.target.value)}

                          day: 'numeric'

                        })}        <div className="mb-8">              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"

                      </p>

                    </div>          <div className="flex items-center gap-3 mb-2">            />

                  </div>

                </div>            <div className="p-3 bg-red-100 rounded-xl">          </div>

              </div>

            ))}              <Shield className="w-8 h-8 text-red-600" />        </div>

          </div>

        )}            </div>

      </div>

            <div>        {loading ? (

      {/* Modal para agregar entrada */}

      {showAddForm && (              <h1 className="text-3xl font-bold text-gray-900">Lista Negra</h1>          <div className="p-6 text-center">Cargando lista negra...</div>

        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn">

          <div className="bg-white rounded-2xl max-w-md w-full shadow-2xl animate-slideUp">              <p className="text-gray-600 mt-1">        ) : (

            {/* Header */}

            <div className="p-6 border-b border-gray-100">                Gestiona las personas restringidas de acceso a las instalaciones          <div className="overflow-x-auto">

              <div className="flex items-center justify-between">

                <div className="flex items-center gap-3">              </p>            <table className="w-full">

                  <div className="p-2 bg-red-100 rounded-lg">

                    <UserX className="w-6 h-6 text-red-600" />            </div>              <thead className="bg-gray-50">

                  </div>

                  <h3 className="text-xl font-bold text-gray-900">          </div>                <tr>

                    Agregar a Lista Negra

                  </h3>        </div>                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">

                </div>

                <button                    Identificador

                  onClick={() => setShowAddForm(false)}

                  className="p-2 hover:bg-gray-100 rounded-lg transition-colors"        {/* Search and Add Button */}                  </th>

                >

                  <X className="w-5 h-5 text-gray-500" />        <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">

                </button>

              </div>          <div className="flex flex-col sm:flex-row gap-4 items-center">                    Tipo

            </div>

            <div className="flex-1 w-full relative">                  </th>

            {/* Form */}

            <form onSubmit={handleAdd} className="p-6 space-y-5">              <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">

              {/* Photo Upload */}

              <div>              <input                    Raz√≥n

                <label className="block text-sm font-semibold text-gray-700 mb-3">

                  Foto del visitante (opcional)                type="text"                  </th>

                </label>

                <div className="flex items-center gap-4">                placeholder="Buscar por nombre, correo o motivo..."                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">

                  {newEntry.photo ? (

                    <div className="relative">                value={searchTerm}                    Fecha

                      <img

                        src={newEntry.photo}                onChange={(e) => setSearchTerm(e.target.value)}                  </th>

                        alt="Preview"

                        className="w-24 h-24 rounded-xl object-cover border-2 border-gray-200"                className="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">

                      />

                      <button              />                    Acciones

                        type="button"

                        onClick={() => setNewEntry({ ...newEntry, photo: '' })}            </div>                  </th>

                        className="absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"

                      >            <button                </tr>

                        <X className="w-4 h-4" />

                      </button>              onClick={() => setShowAddForm(true)}              </thead>

                    </div>

                  ) : (              className="w-full sm:w-auto px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg shadow-red-200 font-semibold flex items-center justify-center gap-2"              <tbody className="bg-white divide-y divide-gray-200">

                    <div className="w-24 h-24 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center bg-gray-50">

                      <Camera className="w-8 h-8 text-gray-400" />            >                {filteredEntries.map((entry) => (

                    </div>

                  )}              <UserX className="w-5 h-5" />                  <tr key={entry._id} className="hover:bg-gray-50">

                  <div className="flex-1">

                    <input              Agregar a Lista Negra                    <td className="px-6 py-4 whitespace-nowrap">

                      ref={fileInputRef}

                      type="file"            </button>                      <div className="text-sm font-medium text-gray-900">{entry.identifier}</div>

                      accept="image/*"

                      onChange={handlePhotoUpload}          </div>                      {entry.notes && (

                      className="hidden"

                    />        </div>                        <div className="text-sm text-gray-500">{entry.notes}</div>

                    <button

                      type="button"                      )}

                      onClick={() => fileInputRef.current?.click()}

                      className="w-full px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-medium flex items-center justify-center gap-2"        {/* Content */}                    </td>

                    >

                      <Upload className="w-5 h-5" />        {loading ? (                    <td className="px-6 py-4 whitespace-nowrap">

                      {newEntry.photo ? 'Cambiar foto' : 'Subir foto'}

                    </button>          <div className="flex items-center justify-center py-20">                      <span className="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">

                    <p className="text-xs text-gray-500 mt-2">

                      JPG, PNG o GIF. M√°ximo 5MB.            <div className="text-center">                        {getIdentifierTypeLabel(entry.identifierType)}

                    </p>

                  </div>              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"></div>                      </span>

                </div>

              </div>              <p className="text-gray-600">Cargando lista negra...</p>                    </td>



              {/* Visitor Name */}            </div>                    <td className="px-6 py-4">

              <div>

                <label className="block text-sm font-semibold text-gray-700 mb-2">          </div>                      <div className="text-sm text-gray-900">{entry.reason}</div>

                  Nombre del visitante *

                </label>        ) : filteredEntries.length === 0 ? (                    </td>

                <input

                  type="text"          <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">

                  value={newEntry.visitorName}

                  onChange={(e) => setNewEntry({ ...newEntry, visitorName: e.target.value })}            <div className="max-w-md mx-auto">                      {new Date(entry.createdAt).toLocaleDateString()}

                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"

                  placeholder="Nombre completo"              <div className="p-4 bg-gray-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">                    </td>

                  required

                />                <UserX className="w-10 h-10 text-gray-400" />                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">

              </div>

              </div>                      <button

              {/* Email */}

              <div>              <h3 className="text-xl font-semibold text-gray-900 mb-2">                        onClick={() => handleRemove(entry._id)}

                <label className="block text-sm font-semibold text-gray-700 mb-2">

                  Correo electr√≥nico *                {searchTerm ? 'No se encontraron resultados' : 'No hay entradas en la lista negra'}                        className="text-red-600 hover:text-red-900"

                </label>

                <input              </h3>                      >

                  type="email"

                  value={newEntry.email}              <p className="text-gray-600">                        Eliminar

                  onChange={(e) => setNewEntry({ ...newEntry, email: e.target.value })}

                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"                {searchTerm                       </button>

                  placeholder="correo@ejemplo.com"

                  required                  ? 'Intenta con otros t√©rminos de b√∫squeda'                     </td>

                />

              </div>                  : 'Agrega personas a la lista negra para restringir su acceso'}                  </tr>



              {/* Reason */}              </p>                ))}

              <div>

                <label className="block text-sm font-semibold text-gray-700 mb-2">            </div>              </tbody>

                  Motivo *

                </label>          </div>            </table>

                <textarea

                  value={newEntry.reason}        ) : (

                  onChange={(e) => setNewEntry({ ...newEntry, reason: e.target.value })}

                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all resize-none"          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">            {filteredEntries.length === 0 && (

                  rows={4}

                  placeholder="Describe el motivo por el cual se agrega a la lista negra..."            {filteredEntries.map((entry) => (              <div className="p-6 text-center text-gray-500">

                  required

                />              <div                {searchTerm ? 'No se encontraron entradas que coincidan con la b√∫squeda' : 'No hay entradas en la lista negra'}

              </div>

                key={entry._id}              </div>

              {/* Buttons */}

              <div className="flex gap-3 pt-4">                className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-xl transition-all duration-300 group"            )}

                <button

                  type="button"              >          </div>

                  onClick={() => setShowAddForm(false)}

                  className="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold"                {/* Photo Section */}        )}

                >

                  Cancelar                <div className="relative h-48 bg-gradient-to-br from-red-50 to-red-100">      </div>

                </button>

                <button                  {entry.photo ? (

                  type="submit"

                  className="flex-1 px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg shadow-red-200 font-semibold"                    <img      {/* Modal para agregar entrada */}

                >

                  Agregar                      src={entry.photo}      {showAddForm && (

                </button>

              </div>                      alt={entry.visitorName}        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">

            </form>

          </div>                      className="w-full h-full object-cover"          <div className="bg-white rounded-lg max-w-md w-full p-6">

        </div>

      )}                    />            <h3 className="text-lg font-semibold text-gray-800 mb-4">



      <style>{`                  ) : (              Agregar a Lista Negra

        @keyframes fadeIn {

          from {                    <div className="w-full h-full flex items-center justify-center">            </h3>

            opacity: 0;

          }                      <div className="p-6 bg-red-200 rounded-full">

          to {

            opacity: 1;                        <UserX className="w-16 h-16 text-red-600" />            <form onSubmit={handleAdd} className="space-y-4">

          }

        }                      </div>              <div>

        @keyframes slideUp {

          from {                    </div>                <label className="block text-sm font-medium text-gray-700 mb-2">

            transform: translateY(20px);

            opacity: 0;                  )}                  Tipo de Identificador

          }

          to {                  <div className="absolute top-3 right-3">                </label>

            transform: translateY(0);

            opacity: 1;                    <button                <select

          }

        }                      onClick={() => handleRemove(entry._id)}                  value={newEntry.identifierType}

        .animate-fadeIn {

          animation: fadeIn 0.2s ease-out;                      className="p-2 bg-white/90 backdrop-blur-sm rounded-lg hover:bg-red-50 transition-colors shadow-lg"                  onChange={(e) => setNewEntry({ ...newEntry, identifierType: e.target.value as any })}

        }

        .animate-slideUp {                      title="Eliminar de la lista negra"                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"

          animation: slideUp 0.3s ease-out;

        }                    >                >

      `}</style>

    </div>                      <Trash2 className="w-5 h-5 text-red-600" />                  <option value="document">Documento</option>

  );

};                    </button>                  <option value="phone">Tel√©fono</option>


                  </div>                  <option value="email">Email</option>

                </div>                </select>

              </div>

                {/* Content Section */}

                <div className="p-6">              <div>

                  <h3 className="text-xl font-bold text-gray-900 mb-3 group-hover:text-red-600 transition-colors">                <label className="block text-sm font-medium text-gray-700 mb-2">

                    {entry.visitorName}                  Identificador

                  </h3>                </label>

                                  <input

                  <div className="space-y-3">                  type="text"

                    <div className="flex items-start gap-2">                  value={newEntry.identifier}

                      <Mail className="w-5 h-5 text-gray-400 flex-shrink-0 mt-0.5" />                  onChange={(e) => setNewEntry({ ...newEntry, identifier: e.target.value })}

                      <div className="flex-1 min-w-0">                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"

                        <p className="text-sm text-gray-500 mb-1">Correo electr√≥nico</p>                  placeholder="N√∫mero de documento, tel√©fono o email"

                        <p className="text-sm font-medium text-gray-900 break-all">{entry.identifier}</p>                  required

                      </div>                />

                    </div>              </div>



                    <div className="flex items-start gap-2">              <div>

                      <AlertCircle className="w-5 h-5 text-red-500 flex-shrink-0 mt-0.5" />                <label className="block text-sm font-medium text-gray-700 mb-2">

                      <div className="flex-1">                  Raz√≥n

                        <p className="text-sm text-gray-500 mb-1">Motivo</p>                </label>

                        <p className="text-sm text-gray-900 leading-relaxed">{entry.reason}</p>                <input

                      </div>                  type="text"

                    </div>                  value={newEntry.reason}

                  onChange={(e) => setNewEntry({ ...newEntry, reason: e.target.value })}

                    <div className="pt-3 border-t border-gray-100">                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"

                      <p className="text-xs text-gray-500">                  placeholder="Motivo de inclusi√≥n en lista negra"

                        Agregado el {new Date(entry.createdAt).toLocaleDateString('es-MX', {                  required

                          year: 'numeric',                />

                          month: 'long',              </div>

                          day: 'numeric'

                        })}              <div>

                      </p>                <label className="block text-sm font-medium text-gray-700 mb-2">

                    </div>                  Notas (opcional)

                  </div>                </label>

                </div>                <textarea

              </div>                  value={newEntry.notes}

            ))}                  onChange={(e) => setNewEntry({ ...newEntry, notes: e.target.value })}

          </div>                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"

        )}                  rows={3}

      </div>                  placeholder="Informaci√≥n adicional"

                />

      {/* Modal para agregar entrada */}              </div>

      {showAddForm && (

        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-fadeIn">              <div className="flex space-x-3 pt-4">

          <div className="bg-white rounded-2xl max-w-md w-full shadow-2xl animate-slideUp">                <button

            {/* Header */}                  type="submit"

            <div className="p-6 border-b border-gray-100">                  className="flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors"

              <div className="flex items-center justify-between">                >

                <div className="flex items-center gap-3">                  Agregar

                  <div className="p-2 bg-red-100 rounded-lg">                </button>

                    <UserX className="w-6 h-6 text-red-600" />                <button

                  </div>                  type="button"

                  <h3 className="text-xl font-bold text-gray-900">                  onClick={() => setShowAddForm(false)}

                    Agregar a Lista Negra                  className="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors"

                  </h3>                >

                </div>                  Cancelar

                <button                </button>

                  onClick={() => setShowAddForm(false)}              </div>

                  className="p-2 hover:bg-gray-100 rounded-lg transition-colors"            </form>

                >          </div>

                  <X className="w-5 h-5 text-gray-500" />        </div>

                </button>      )}

              </div>    </div>

            </div>  );

};
            {/* Form */}
            <form onSubmit={handleAdd} className="p-6 space-y-5">
              {/* Photo Upload */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-3">
                  Foto del visitante (opcional)
                </label>
                <div className="flex items-center gap-4">
                  {newEntry.photo ? (
                    <div className="relative">
                      <img
                        src={newEntry.photo}
                        alt="Preview"
                        className="w-24 h-24 rounded-xl object-cover border-2 border-gray-200"
                      />
                      <button
                        type="button"
                        onClick={() => setNewEntry({ ...newEntry, photo: '' })}
                        className="absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"
                      >
                        <X className="w-4 h-4" />
                      </button>
                    </div>
                  ) : (
                    <div className="w-24 h-24 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center bg-gray-50">
                      <Camera className="w-8 h-8 text-gray-400" />
                    </div>
                  )}
                  <div className="flex-1">
                    <input
                      ref={fileInputRef}
                      type="file"
                      accept="image/*"
                      onChange={handlePhotoUpload}
                      className="hidden"
                    />
                    <button
                      type="button"
                      onClick={() => fileInputRef.current?.click()}
                      className="w-full px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-medium flex items-center justify-center gap-2"
                    >
                      <Upload className="w-5 h-5" />
                      {newEntry.photo ? 'Cambiar foto' : 'Subir foto'}
                    </button>
                    <p className="text-xs text-gray-500 mt-2">
                      JPG, PNG o GIF. M√°ximo 5MB.
                    </p>
                  </div>
                </div>
              </div>

              {/* Visitor Name */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Nombre del visitante *
                </label>
                <input
                  type="text"
                  value={newEntry.visitorName}
                  onChange={(e) => setNewEntry({ ...newEntry, visitorName: e.target.value })}
                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"
                  placeholder="Nombre completo"
                  required
                />
              </div>

              {/* Email */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Correo electr√≥nico *
                </label>
                <input
                  type="email"
                  value={newEntry.email}
                  onChange={(e) => setNewEntry({ ...newEntry, email: e.target.value })}
                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all"
                  placeholder="correo@ejemplo.com"
                  required
                />
              </div>

              {/* Reason */}
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Motivo *
                </label>
                <textarea
                  value={newEntry.reason}
                  onChange={(e) => setNewEntry({ ...newEntry, reason: e.target.value })}
                  className="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all resize-none"
                  rows={4}
                  placeholder="Describe el motivo por el cual se agrega a la lista negra..."
                  required
                />
              </div>

              {/* Buttons */}
              <div className="flex gap-3 pt-4">
                <button
                  type="button"
                  onClick={() => setShowAddForm(false)}
                  className="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold"
                >
                  Cancelar
                </button>
                <button
                  type="submit"
                  className="flex-1 px-4 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg shadow-red-200 font-semibold"
                >
                  Agregar
                </button>
              </div>
            </form>
          </div>
        </div>
      )}

      <style>{`
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        @keyframes slideUp {
          from {
            transform: translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateY(0);
            opacity: 1;
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.2s ease-out;
        }
        .animate-slideUp {
          animation: slideUp 0.3s ease-out;
        }
      `}</style>
    </div>
  );
};
